# Novel Builder - å•å…ƒæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2026-01-30
**æµ‹è¯•æ¡†æ¶**: Flutter Test
**è¦†ç›–ç‡å·¥å…·**: lcov

---

## ğŸ“Š æ€»ä½“è¦†ç›–ç‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯„çº§ |
|------|------|------|
| **è¡Œè¦†ç›–ç‡** | 22.5% (2,312 / 10,292) | ğŸ”´ éœ€æ”¹è¿› |
| **å‡½æ•°è¦†ç›–ç‡** | N/A | - |
| **æµ‹è¯•æ–‡ä»¶æ•°** | 46 | - |
| **æµ‹è¯•ç”¨ä¾‹æ•°** | 565+ | - |

---

## ğŸ“¦ æ¨¡å—è¦†ç›–ç‡è¯¦æƒ…

### é«˜è¦†ç›–ç‡æ¨¡å— (>50%)

| æ¨¡å— | è¦†ç›–ç‡ | çŠ¶æ€ |
|------|--------|------|
| **models** | ~95% | ğŸŸ¢ ä¼˜ç§€ |
| **services** | ~40% | ğŸŸ¡ ä¸€èˆ¬ |
| **widgets** | ~30% | ğŸŸ¡ ä¸€èˆ¬ |
| **controllers** | ~25% | ğŸŸ  è¾ƒä½ |

### ä½è¦†ç›–ç‡æ¨¡å— (<20%)

| æ¨¡å— | è¦†ç›–ç‡ | çŠ¶æ€ |
|------|--------|------|
| **screens** | <5% | ğŸ”´ éœ€æ”¹è¿› |
| **mixins** | <5% | ğŸ”´ éœ€æ”¹è¿› |
| **utils** | <10% | ğŸ”´ éœ€æ”¹è¿› |

---

## ğŸŸ¢ è¦†ç›–ç‡æœ€é«˜çš„æ–‡ä»¶ (Top 10)

è¿™äº›æ–‡ä»¶æœ‰å®Œå–„çš„å•å…ƒæµ‹è¯•,å€¼å¾—ä½œä¸ºå‚è€ƒ:

| æ–‡ä»¶ | è¦†ç›–ç‡ | è¯´æ˜ |
|------|--------|------|
| `models/chapter.dart` | 100% | ç« èŠ‚æ¨¡å‹ |
| `models/character_update.dart` | 100% | è§’è‰²æ›´æ–°æ¨¡å‹ |
| `widgets/common/confirm_dialog.dart` | 100% | ç¡®è®¤å¯¹è¯æ¡† |
| `controllers/chapter_action_handler.dart` | 100% | ç« èŠ‚æ“ä½œå¤„ç†å™¨ |
| `services/rate_limiter.dart` | 100% | é€Ÿç‡é™åˆ¶æœåŠ¡ |
| `services/chapter_service.dart` | 100% | ç« èŠ‚æœåŠ¡ |
| `widgets/chapter_list/chapter_title.dart` | 100% | ç« èŠ‚æ ‡é¢˜ç»„ä»¶ |
| `widgets/tts_control_panel.dart` | 100% | TTS æ§åˆ¶é¢æ¿ |
| `models/character_relationship.dart` | 98.4% | è§’è‰²å…³ç³»æ¨¡å‹ |
| `widgets/tts_content_display.dart` | 96.0% | TTS å†…å®¹æ˜¾ç¤º |

---

## ğŸ”´ è¦†ç›–ç‡æœ€ä½çš„æ–‡ä»¶ (Top 10)

è¿™äº›æ–‡ä»¶éœ€è¦æ·»åŠ å•å…ƒæµ‹è¯•:

| æ–‡ä»¶ | è¦†ç›–ç‡ | ä¼˜å…ˆçº§ | å»ºè®® |
|------|--------|--------|------|
| `services/tts_service.dart` | 0% | ğŸ”´ é«˜ | æ ¸å¿ƒ TTS åŠŸèƒ½,éœ€è¦æµ‹è¯• |
| `models/tts_timer_config.dart` | 0% | ğŸŸ¡ ä¸­ | TTS å®šæ—¶å™¨é…ç½® |
| `models/reading_progress.dart` | 0% | ğŸŸ¡ ä¸­ | é˜…è¯»è¿›åº¦æ¨¡å‹ |
| `services/tts_player_service.dart` | 0% | ğŸ”´ é«˜ | TTS æ’­æ”¾å™¨æœåŠ¡ |
| `widgets/character_preview_dialog.dart` | 0% | ğŸŸ¡ ä¸­ | è§’è‰²é¢„è§ˆå¯¹è¯æ¡† |
| `widgets/character_input_dialog.dart` | 0% | ğŸŸ¡ ä¸­ | è§’è‰²è¾“å…¥å¯¹è¯æ¡† |
| `services/preload_progress_update.dart` | 0% | ğŸŸ¢ ä½ | é¢„åŠ è½½è¿›åº¦æ›´æ–° |
| `widgets/streaming_content_display.dart` | 0% | ğŸŸ¡ ä¸­ | æµå¼å†…å®¹æ˜¾ç¤º |
| `widgets/streaming_status_indicator.dart` | 0% | ğŸŸ¡ ä¸­ | æµå¼çŠ¶æ€æŒ‡ç¤ºå™¨ |
| `constants/chapter_constants.dart` | 0% | ğŸŸ¢ ä½ | ç« èŠ‚å¸¸é‡ |

---

## ğŸ¯ æµ‹è¯•è¦†ç›–çš„å…³é”®åŠŸèƒ½

### âœ… å·²æµ‹è¯•

- âœ… **ç« èŠ‚ç®¡ç†**: Chapter æ¨¡å‹å’ŒæœåŠ¡
- âœ… **è§’è‰²å…³ç³»**: CharacterRelationship æ¨¡å‹
- âœ… **TTS ç»„ä»¶**: TTS æ§åˆ¶é¢æ¿å’Œå†…å®¹æ˜¾ç¤º
- âœ… **ç« èŠ‚åˆ—è¡¨**: ç« èŠ‚æ ‡é¢˜å’Œæ“ä½œå¤„ç†å™¨
- âœ… **é€šç”¨å¯¹è¯æ¡†**: ç¡®è®¤å¯¹è¯æ¡†
- âœ… **é€Ÿç‡é™åˆ¶**: RateLimiter æœåŠ¡
- âœ… **æ—¥å¿—æŸ¥çœ‹å™¨**: LogViewerScreen (å®Œæ•´æµ‹è¯•å¥—ä»¶)

### âŒ æœªæµ‹è¯•

- âŒ **TTS æœåŠ¡**: TTS æœåŠ¡æ ¸å¿ƒé€»è¾‘
- âŒ **è§’è‰²ç®¡ç†**: CharacterInputDialog å’Œé¢„è§ˆå¯¹è¯æ¡†
- âŒ **AI åŠŸèƒ½**: Dify æœåŠ¡å’Œ AI ä¼´è¯»åŠŸèƒ½
- âŒ **é˜…è¯»å™¨**: ReaderScreen æ ¸å¿ƒåŠŸèƒ½
- âŒ **èƒŒæ™¯è®¾å®š**: BackgroundSettingScreen
- âŒ **å…³ç³»å›¾**: UnifiedRelationshipGraphScreen (æ–°æ·»åŠ )

---

## ğŸ“ˆ æµ‹è¯•ç”¨ä¾‹ç»Ÿè®¡

### æŒ‰ç±»å‹åˆ†ç±»

| æµ‹è¯•ç±»å‹ | æ–‡ä»¶æ•° | æµ‹è¯•ç”¨ä¾‹æ•° | å æ¯” |
|---------|--------|-----------|------|
| **Widget æµ‹è¯•** | 25+ | 300+ | ~53% |
| **Unit æµ‹è¯•** | 15+ | 200+ | ~35% |
| **Integration æµ‹è¯•** | 5+ | 65+ | ~12% |

### æŒ‰æ¨¡å—åˆ†ç±»

| æ¨¡å— | æµ‹è¯•æ–‡ä»¶æ•° | ä¸»è¦æµ‹è¯•å†…å®¹ |
|------|-----------|-------------|
| **widgets** | 20+ | UI ç»„ä»¶ã€å¯¹è¯æ¡†ã€åˆ—è¡¨ |
| **models** | 5+ | æ•°æ®æ¨¡å‹ã€åºåˆ—åŒ– |
| **services** | 8+ | ä¸šåŠ¡é€»è¾‘ã€æ•°æ®å¤„ç† |
| **screens** | 3+ | é¡µé¢åŠŸèƒ½ã€äº¤äº’ |
| **controllers** | 2+ | æ§åˆ¶å™¨é€»è¾‘ |
| **mixins** | 0 | æ— æµ‹è¯• |
| **utils** | 2+ | å·¥å…·å‡½æ•° |

---

## ğŸ” è¯¦ç»†åˆ†æ

### è¦†ç›–ç‡åˆ†å¸ƒ

```
ğŸŸ¢ 90-100%: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 8 ä¸ªæ–‡ä»¶
ğŸŸ¡ 70-89%:  â–ˆâ–ˆâ–ˆâ–ˆ 4 ä¸ªæ–‡ä»¶
ğŸŸ  50-69%:  â–ˆâ–ˆ 3 ä¸ªæ–‡ä»¶
ğŸ”´ 0-49%:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 200+ ä¸ªæ–‡ä»¶
```

### æµ‹è¯•æ–‡ä»¶åˆ†å¸ƒ

```
ğŸ“ test/unit/
â”œâ”€â”€ ğŸ“ controllers/       (2 ä¸ªæµ‹è¯•æ–‡ä»¶)
â”œâ”€â”€ ğŸ“ mocks/            (æ¨¡æ‹Ÿå¯¹è±¡)
â”œâ”€â”€ ğŸ“ models/           (5 ä¸ªæµ‹è¯•æ–‡ä»¶) â­
â”œâ”€â”€ ğŸ“ screens/          (3 ä¸ªæµ‹è¯•æ–‡ä»¶)
â”œâ”€â”€ ğŸ“ services/         (8 ä¸ªæµ‹è¯•æ–‡ä»¶) â­
â””â”€â”€ ğŸ“ widgets/          (25+ ä¸ªæµ‹è¯•æ–‡ä»¶) â­â­â­
```

---

## ğŸ’¡ æ”¹è¿›å»ºè®®

### ğŸ¯ çŸ­æœŸç›®æ ‡ (1-2 å‘¨)

1. **ä¸ºæ–°å¢ä»£ç æ·»åŠ æµ‹è¯•**
   - [ ] `NovelContextService` - æ–°æ·»åŠ çš„ä¸Šä¸‹æ–‡æœåŠ¡
   - [ ] `UnifiedRelationshipGraphScreen` - ç»Ÿä¸€å…³ç³»å›¾
   - [ ] ä¼˜åŒ–åçš„ Dialog ç»„ä»¶

2. **æé«˜æ ¸å¿ƒæœåŠ¡è¦†ç›–ç‡**
   - [ ] `TTSPlayerService` - TTS æ’­æ”¾å™¨ (ä¼˜å…ˆçº§:é«˜)
   - [ ] `TTSService` - TTS æœåŠ¡ (ä¼˜å…ˆçº§:é«˜)
   - [ ] `DifyService` - AI æœåŠ¡ (ä¼˜å…ˆçº§:ä¸­)

3. **è¡¥å……å…³é”® Widget æµ‹è¯•**
   - [ ] `CharacterInputDialog` - è§’è‰²è¾“å…¥å¯¹è¯æ¡†
   - [ ] `CharacterPreviewDialog` - è§’è‰²é¢„è§ˆå¯¹è¯æ¡†
   - [ ] `StreamingContentDisplay` - æµå¼å†…å®¹æ˜¾ç¤º

### ğŸ¯ ä¸­æœŸç›®æ ‡ (1 ä¸ªæœˆ)

1. **æ•´ä½“è¦†ç›–ç‡æå‡è‡³ 40%**
   - å½“å‰: 22.5%
   - ç›®æ ‡: 40%
   - éœ€è¦å¢åŠ : ~1,800 è¡Œæµ‹è¯•è¦†ç›–

2. **å»ºç«‹æµ‹è¯•è§„èŒƒ**
   - [ ] æ–°åŠŸèƒ½å¿…é¡»åŒ…å«å•å…ƒæµ‹è¯•
   - [ ] ä»£ç å®¡æŸ¥æ—¶æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡
   - [ ] CI/CD ä¸­é›†æˆè¦†ç›–ç‡æ£€æŸ¥

3. **è¡¥å……ç¼ºå¤±çš„æµ‹è¯•ç±»å‹**
   - [ ] æ·»åŠ  Mixins æµ‹è¯•
   - [ ] æ·»åŠ  Utils æµ‹è¯•
   - [ ] æ·»åŠ  Integration æµ‹è¯•

### ğŸ¯ é•¿æœŸç›®æ ‡ (3 ä¸ªæœˆ)

1. **æ•´ä½“è¦†ç›–ç‡æå‡è‡³ 70%**
   - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘: 80%+
   - UI ç»„ä»¶: 60%+
   - å·¥å…·ç±»: 90%+

2. **å»ºç«‹å®Œå–„çš„æµ‹è¯•ä½“ç³»**
   - å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >70%
   - é›†æˆæµ‹è¯•è¦†ç›–æ ¸å¿ƒæµç¨‹
   - E2E æµ‹è¯•è¦†ç›–å…³é”®ç”¨æˆ·è·¯å¾„

3. **æŒç»­ç›‘æ§**
   - CI/CD ä¸­é›†æˆè¦†ç›–ç‡æŠ¥å‘Š
   - æ¯æ¬¡æäº¤è‡ªåŠ¨æ£€æŸ¥è¦†ç›–ç‡
   - å®šæœŸå®¡æŸ¥å’Œæ”¹è¿›æµ‹è¯•è´¨é‡

---

## ğŸ› ï¸ å¦‚ä½•è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
flutter test
```

### è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•

```bash
# åªæµ‹è¯• services
flutter test test/unit/services/

# åªæµ‹è¯• widgets
flutter test test/unit/widgets/

# åªæµ‹è¯•ç‰¹å®šæ–‡ä»¶
flutter test test/unit/services/chapter_service_test.dart
```

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡
flutter test --coverage

# åˆ†æè¦†ç›–ç‡ (Python è„šæœ¬)
python scripts/analyze_coverage.py

# ç”Ÿæˆ HTML æŠ¥å‘Š (éœ€è¦ lcov)
genhtml coverage/lcov.info -o coverage/html
open coverage/html/index.html
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Flutter æµ‹è¯•æ–‡æ¡£](https://docs.flutter.dev/cookbook/testing)
- [æµ‹è¯•æœ€ä½³å®è·µ](https://docs.flutter.dev/cookbook/testing/introduction)
- [é¡¹ç›®è¦†ç›–ç‡æŒ‡å—](./COVERAGE_GUIDE.md)

---

**æŠ¥å‘Šç”Ÿæˆ**: è‡ªåŠ¨åŒ–è„šæœ¬
**ä¸‹æ¬¡æ›´æ–°**: æ¯å‘¨æ›´æ–°ä¸€æ¬¡
**ç»´æŠ¤è€…**: Novel Builder Team
