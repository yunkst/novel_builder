# 章节列表分页功能

## 任务上下文

**创建时间**: 2026-01-20 21:21:03
**任务描述**: 章节列表页面改成100章一页，同时进入的时候默认跳转到上次阅读的章节
**实施方案**: 方案3 - 混合方案（ListView + 分页控制栏）

## 技术上下文

- **目标文件**: `novel_app/lib/screens/chapter_list_screen.dart`
- **常量文件**: `novel_app/lib/constants/chapter_constants.dart`
- **当前实现**: 使用 `ListView.builder` 一次性加载所有章节
- **目标实现**: 分页加载（100章/页）+ 底部分页控制栏 + 自动跳转上次阅读位置

## 执行步骤

### 步骤1: 添加分页常量
**文件**: `novel_app/lib/constants/chapter_constants.dart`
- 添加 `chaptersPerPage = 100` 常量

### 步骤2: 添加分页状态变量
**文件**: `novel_app/lib/screens/chapter_list_screen.dart`
- 添加 `_currentPage` 和 `_totalPages` 状态变量

### 步骤3: 计算总页数
- 创建 `_updateTotalPages()` 方法
- 在章节加载完成后调用

### 步骤4: 获取当前页章节
- 创建 `_getCurrentPageChapters()` 方法

### 步骤5: 修改ListView显示逻辑
- 修改 `_buildNormalChapterList()` 使用当前页章节

### 步骤6: 创建分页控制栏组件
- 创建 `_buildPaginationControl()` 方法
- 显示页码和导航按钮

### 步骤7: 实现页码跳转方法
- 创建 `_goToPage()` 方法
- 页码切换时自动滚动到顶部

### 步骤8: 修改滚动定位逻辑（核心功能）
- 修改 `_scrollToLastReadChapter()` 方法
- 自动计算并跳转到上次阅读章节所在页
- 滚动到目标章节位置

### 步骤9: 集成分页控制栏到UI
- 修改 `build()` 方法
- 在列表底部显示分页控制栏

### 步骤10: 修正重排模式索引映射
- 重排模式继续显示所有章节（不分页）

## 验收标准

1. **分页功能**:
   - ✅ 每页显示100章
   - ✅ 分页控制栏正确显示当前页/总页数
   - ✅ 首页/上一页/下一页/末页按钮功能正常

2. **自动跳转功能**:
   - ✅ 进入章节列表时自动跳转到上次阅读章节所在页
   - ✅ 自动滚动到目标章节位置（视口上方25%）

3. **边界情况处理**:
   - ✅ 章节数不足100章时显示为1页
   - ✅ 重排模式下分页控制栏隐藏
   - ✅ 空章节列表时不显示分页控制栏

4. **用户体验**:
   - ✅ 页码切换时自动滚动到列表顶部
   - ✅ 滚动动画流畅自然
   - ✅ UI风格与现有界面一致

## 实施记录

- [ ] 步骤1: 添加分页常量
- [ ] 步骤2: 添加分页状态变量
- [ ] 步骤3: 计算总页数
- [ ] 步骤4: 获取当前页章节
- [ ] 步骤5: 修改ListView显示逻辑
- [ ] 步骤6: 创建分页控制栏组件
- [ ] 步骤7: 实现页码跳转方法
- [ ] 步骤8: 修改滚动定位逻辑（核心功能）
- [ ] 步骤9: 集成分页控制栏到UI
- [ ] 步骤10: 测试验证
