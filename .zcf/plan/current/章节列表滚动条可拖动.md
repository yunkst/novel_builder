# 章节列表滚动条可拖动

## 任务上下文

**问题描述**: APP的章节列表，滚动条无法互动，需要改成可以拖动的滚动条

**目标文件**: `novel_app/lib/screens/chapter_list_screen.dart`

**当前实现**: 使用 Flutter 默认的 `Scrollbar` widget，在移动端不可交互

## 解决方案

使用 `draggable_scrollbar` 包（Flutter 社区维护）

## 执行步骤

### 步骤 1: 添加依赖到 pubspec.yaml

**文件**: `novel_app/pubspec.yaml`

**操作**: 在 dependencies 区域添加
```yaml
draggable_scrollbar: ^0.1.0
```

**插入位置**: 第 78 行后（在 `package_info_plus: ^8.0.0` 之后）

**预期结果**: pubspec.yaml 包含 draggable_scrollbar 依赖

---

### 步骤 2: 安装依赖

**命令**: `flutter pub get`

**目录**: `novel_app/`

**预期结果**: 依赖成功安装，无错误

---

### 步骤 3: 修改 chapter_list_screen.dart

**文件**: `novel_app/lib/screens/chapter_list_screen.dart`

#### 3.1 添加导入

**位置**: 第 26 行（现有 import 之后）

**添加**:
```dart
import 'package:draggable_scrollbar/draggable_scrollbar.dart';
```

#### 3.2 修改 `_buildNormalChapterList()` 方法

**位置**: 第 800-839 行

**当前代码**:
```dart
Widget _buildNormalChapterList() {
  return Scrollbar(
    controller: _scrollController,
    child: ListView.builder(
      controller: _scrollController,
      itemCount: _chapters.length,
      itemBuilder: (context, index) {
        final chapter = _chapters[index];
        final isLastRead = index == _lastReadChapterIndex;
        final isUserChapter = chapter.isUserInserted;

        return ChapterListItem(
          chapter: chapter,
          isLastRead: isLastRead,
          isUserChapter: isUserChapter,
          isCached: _cachedStatus[chapter.url] ?? false,
          onTap: () { ... },
          onLongPress: () { ... },
          onInsert: () => _showInsertChapterDialog(index),
          onDelete: chapter.isUserInserted
              ? () => _showDeleteChapterDialog(chapter, index)
              : null,
        );
      },
    ),
  );
}
```

**修改为**:
```dart
Widget _buildNormalChapterList() {
  return DraggableScrollbar.rrect(
    controller: _scrollController,
    child: ListView.builder(
      controller: _scrollController,
      itemCount: _chapters.length,
      itemBuilder: (context, index) {
        final chapter = _chapters[index];
        final isLastRead = index == _lastReadChapterIndex;
        final isUserChapter = chapter.isUserInserted;

        return ChapterListItem(
          chapter: chapter,
          isLastRead: isLastRead,
          isUserChapter: isUserChapter,
          isCached: _cachedStatus[chapter.url] ?? false,
          onTap: () {
            Navigator.push(
              context,
              MaterialPageRoute(
                builder: (context) => ReaderScreen(
                  novel: widget.novel,
                  chapter: chapter,
                  chapters: _chapters,
                ),
              ),
            );
          },
          onLongPress: () {
            _toggleReorderingMode();
          },
          onInsert: () => _showInsertChapterDialog(index),
          onDelete: chapter.isUserInserted
              ? () => _showDeleteChapterDialog(chapter, index)
              : null,
        );
      },
    ),
  );
}
```

**变更说明**:
- 将 `Scrollbar` 替换为 `DraggableScrollbar.rrect`
- `DraggableScrollbar.rrect` 提供圆角矩形样式的可拖动滚动条
- 保留所有其他功能不变

**预期结果**: 章节列表显示可拖动的滚动条

---

### 步骤 4: 测试功能

**操作**:
1. 启动 Flutter 应用
2. 导航到章节列表页面
3. 测试滚动条拖动功能

**预期结果**:
- 滚动条可见
- 可以拖动滚动条快速浏览章节
- 拖动流畅无卡顿

## 参考资料

- 包地址: https://pub.dev/packages/draggable_scrollbar
- 维护者: Flutter Community
- API 文档: https://pub.dev/documentation/draggable_scrollbar/latest/

## 注意事项

1. `draggable_scrollbar` 包的 `rrect` 样式提供圆角矩形滚动条
2. 如果需要显示章节标题标签，可以使用 `labelTextBuilder` 参数
3. 确保不破坏现有的重排模式功能（`_buildReorderableChapterList` 不受影响）
