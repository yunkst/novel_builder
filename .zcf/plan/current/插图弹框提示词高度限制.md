# 插图弹框提示词高度限制 - 执行计划

## 任务信息

- **创建时间**: 2026-02-10 00:12:05
- **任务描述**: 插图组件,点击插图之后,弹出的弹框,限制原始提示词高度为固定值
- **需求状态**: ✅ 已批准
- **执行状态**: 🔄 进行中

---

## 需求分析

### 用户需求
- **固定高度值**: 200像素
- **超出处理方式**: 显示滚动条
- **目标组件**: `lib/widgets/illustration_action_dialog.dart` 中的 `_PromptsDisplayCard`

### 问题分析
当前实现中,`_PromptsDisplayCard` 使用 `SelectableText` 直接显示提示词,没有高度限制:
- 短提示词: 正常显示
- **长提示词**: 导致弹框过大,影响用户体验

---

## 技术方案

### 选定方案: ConstrainedBox + SingleChildScrollView

**方案优势**:
- 短文本时自适应高度,不会留白
- 长文本时限制200px并显示滚动条
- 实现简单,代码改动最小
- 保持现有样式和功能

### 实现位置
- **文件**: `lib/widgets/illustration_action_dialog.dart`
- **类**: `_PromptsDisplayCard`
- **方法**: `build()` (第216-278行)
- **具体位置**: 第251-259行(提示词显示区域)

---

## 执行步骤

### ✅ 步骤1: 创建执行计划文档
- [x] 创建 `.zcf/plan/current/插图弹框提示词高度限制.md`
- [x] 记录任务上下文和执行步骤

### ✅ 步骤2: 修改 _PromptsDisplayCard 布局结构
- [x] 修改 `lib/widgets/illustration_action_dialog.dart`
- [x] 在 `SelectableText` 外包裹 `ConstrainedBox`
- [x] 添加 `SingleChildScrollView` 实现滚动
- [x] 设置 `BoxConstraints(maxHeight: 200)`

### ✅ 步骤3: 调整内边距和间距
- [x] 检查并优化布局间距
- [x] 确保视觉效果协调(原有间距保持不变)

### ⏳ 步骤4: 验证功能
- [ ] 测试短提示词显示
- [ ] 测试长提示词滚动
- [ ] 验证复制和选择功能

### ✅ 步骤5: 代码质量检查
- [x] 运行 `flutter analyze` - ✅ 通过
- [x] 运行 `dart format` - ✅ 通过

---

## 代码变更

### 修改前 (第251-259行)
```dart
const SizedBox(height: 12),
// 提示词内容
SelectableText(
  prompts,
  style: TextStyle(
    fontSize: 15,
    color: Theme.of(context).colorScheme.onSurface,
    height: 1.5,
  ),
),
```

### 修改后
```dart
const SizedBox(height: 12),
// 提示词内容
ConstrainedBox(
  constraints: BoxConstraints(maxHeight: 200),
  child: SingleChildScrollView(
    child: SelectableText(
      prompts,
      style: TextStyle(
        fontSize: 15,
        color: Theme.of(context).colorScheme.onSurface,
        height: 1.5,
      ),
    ),
  ),
),
```

---

## 成功标准

- [ ] 提示词显示区域最大高度不超过200px
- [ ] 内容超出时显示垂直滚动条
- [ ] 短文本时无滚动条,高度自适应
- [ ] 文本可选择和复制功能正常
- [ ] 代码通过 `flutter analyze` 检查

---

## 测试计划

### 测试场景
1. **短提示词**: 验证无滚动条,高度自适应
2. **长提示词**: 验证出现滚动条并可滚动
3. **复制功能**: 验证复制按钮正常工作
4. **文本选择**: 验证文本可选择功能

### 测试命令
```bash
cd novel_app
flutter run
# 手动测试插图弹框功能
```

---

## 风险评估

- **风险等级**: 低
- **影响范围**: 仅影响 `illustration_action_dialog.dart` 中的 `_PromptsDisplayCard`
- **向后兼容**: ✅ 完全兼容,不影响其他功能

---

## 备注

- 保持现有琥珀色主题样式
- 确保滚动条样式与主题一致
- 维护文本选择和复制功能
