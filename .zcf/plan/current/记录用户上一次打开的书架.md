# 执行计划：记录用户上一次打开的书架

**创建时间**：2026-02-03 23:35:35

## 任务描述

记录用户上一次打开的书架，关闭app再打开会重新展示这个书架内容

## 技术方案

修改`CurrentBookshelfId` Provider，集成SharedPreferences持久化

## 实施步骤

### 步骤1：添加SharedPreferences持久化

**文件**：`novel_app/lib/core/providers/bookshelf_providers.dart`

**改动内容**：
- 添加私有常量`_key = 'current_bookshelf_id'`
- 添加`_loadSavedBookshelfId()`异步方法
- 在`build()`中调用异步加载
- 在`setBookshelfId()`中保存到SharedPreferences

### 步骤2：重新生成Riverpod代码

**命令**：`dart run build_runner build --delete-conflicting-outputs`

### 步骤3：功能测试

**测试场景**：
1. 切换书架后重启app，验证是否恢复
2. 首次启动验证默认值
3. 异常情况验证

## 预期结果

- ✅ 用户切换书架后，书架ID自动保存到SharedPreferences
- ✅ 重启app后，自动加载上次的书架ID
- ✅ 首次启动显示默认书架（ID=1）
- ✅ 不影响现有功能

## 涉及文件

- `novel_app/lib/core/providers/bookshelf_providers.dart`（修改）
- `novel_app/lib/core/providers/bookshelf_providers.g.dart`（重新生成）
