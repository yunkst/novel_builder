# 角色关系图单元测试实施计划

## 任务信息
- **任务名称**: 角色关系图单元测试
- **创建时间**: 2026-01-25 18:02:09
- **任务类型**: 全面测试覆盖（方案B）

## 上下文

### 测试范围
1. CharacterRelationship 模型单元测试
2. CharacterRelationshipScreen UI Widget测试
3. CharacterRelationshipGraphScreen UI Widget测试
4. Mock数据库服务
5. CustomPainter绘制逻辑验证

### 测试目标
- 验证核心业务逻辑正确性
- 验证UI交互流程
- 覆盖边界条件和异常场景
- 提供回归测试保障

## 实施计划

### 第一阶段：模型单元测试

#### 步骤1.1：创建测试数据工厂
**文件**: `test/test_helpers/character_relationship_test_data.dart`

- 创建`createTestCharacter()`方法
- 创建`createTestRelationship()`方法
- 创建`createTestRelationshipList()`方法
- 提供默认值和可选参数

#### 步骤1.2：创建模型测试文件
**文件**: `test/unit/models/character_relationship_test.dart`

测试组：
- 构造函数和默认值（4个测试）
- 序列化/反序列化（4个测试）
- copyWith方法（4个测试）
- isSameRelationship方法（3个测试）
- getReverseTypeHint方法（9个测试）
- toString方法（2个测试）
- 相等性和哈希码（3个测试）

**预期**: 29个测试用例，覆盖率>95%

### 第二阶段：关系列表UI测试

**文件**: `test/unit/widgets/character_relationship_screen_test.dart`

测试组：
- 加载状态（3个测试）
- 空状态渲染（2个测试）
- 关系列表渲染（4个测试）
- 交互测试（5个测试）
- Tab切换（1个测试）

**预期**: 15个测试用例

### 第三阶段：关系图UI测试

**文件**: `test/unit/widgets/character_relationship_graph_screen_test.dart`

测试组：
- 加载状态（3个测试）
- 空状态渲染（1个测试）
- CustomPainter参数验证（4个测试）
- 布局计算测试（3个测试）
- 交互测试（5个测试）
- shouldRepaint验证（4个测试）
- 节点和边数据验证（3个测试）

**预期**: 23个测试用例

### 第四阶段：运行和验证

- 运行所有测试
- 生成覆盖率报告
- 修复问题
- 验证通过

## 验收标准

- [ ] 所有测试用例通过
- [ ] CharacterRelationship模型覆盖率>95%
- [ ] UI测试覆盖主要交互流程
- [ ] 代码清晰易读

## 预计工作量

约7小时
