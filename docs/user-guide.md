# Novel Builder 用户指南

## 目录
- [安装指南](#安装指南)
- [基本使用](#基本使用)
- [功能介绍](#功能介绍)
- [常见问题](#常见问题)
- [故障排除](#故障排除)

## 安装指南

### 方法1：Docker 部署（推荐）

1. **克隆项目**
```bash
git clone https://github.com/yedazhi/novel_builder.git
cd novel_builder
```

2. **配置环境变量**
```bash
cp .env.example .env
# 编辑 .env 文件，设置必要的环境变量
```

3. **启动服务**
```bash
docker-compose up -d
```

4. **访问应用**
- 后端API：http://localhost:3800
- API文档：http://localhost:3800/docs
- Flutter应用：需要编译后在设备上运行

### 方法2：本地开发环境

#### 后端设置
```bash
cd backend
pip install -r requirements.txt
# 或者使用 pyproject.toml
pip install -e .

# 启动数据库
docker-compose up -d postgres

# 运行数据库迁移
alembic upgrade head

# 启动后端服务
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

#### Flutter 应用设置
```bash
cd novel_app
flutter pub get
flutter run
```

## 基本使用

### 1. 搜索小说

1. 打开 Flutter 应用
2. 在搜索页面输入关键词
3. 选择要搜索的小说站点（支持多站点同时搜索）
4. 浏览搜索结果，点击感兴趣的小说

### 2. 添加到书架

1. 在小说详情页面，点击"添加到书架"
2. 小说将被保存到本地书架
3. 可以查看小说的基本信息和章节列表

### 3. 阅读小说

1. 在书架中点击小说封面进入阅读页面
2. 点击章节标题开始阅读
3. 使用手势或按钮翻页
4. 阅读进度会自动保存

### 4. 缓存章节

1. 在书架页面选择小说
2. 点击"缓存"按钮
3. 选择要缓存的章节范围
4. 等待缓存完成（支持后台下载）

## 功能介绍

### 📚 书架管理
- **添加小说**：从搜索结果添加到个人书架
- **阅读进度**：自动记录每个章节的阅读进度
- **批量操作**：支持批量缓存、删除等操作
- **分类管理**：可以创建不同分类管理小说

### 🔍 智能搜索
- **多站点搜索**：同时搜索多个小说网站
- **结果聚合**：去重和排序搜索结果
- **历史记录**：保存搜索历史，方便重复搜索
- **高级过滤**：按作者、状态、字数等条件过滤

### 💾 缓存系统
- **本地缓存**：SQLite 本地数据库存储
- **云端缓存**：PostgreSQL 服务器端缓存
- **智能预加载**：自动缓存下一章节
- **存储管理**：查看缓存占用空间，清理过期内容

### 🤖 AI 增强
- **特写生成**：基于当前章节生成扩展内容
- **角色卡提取**：智能识别和分析章节中的角色
- **场景插图**：为关键场景生成 AI 插图
- **内容总结**：生成章节内容摘要

### ⚙️ 个性化设置
- **阅读设置**：字体大小、背景颜色、翻页方式
- **网络配置**：代理设置、请求超时
- **缓存策略**：自动缓存规则、存储限制
- **主题切换**：日间/夜间模式

## 常见问题

### Q: 如何备份我的书架数据？
A: 书架数据存储在应用的 SQLite 数据库中，可以复制整个应用数据目录进行备份。

### Q: 为什么搜索结果为空？
A: 可能的原因：
- 网络连接问题
- 目标小说站点暂时无法访问
- 搜索关键词过于具体

### Q: 缓存失败怎么办？
A: 检查以下设置：
- 网络连接状态
- 存储空间是否充足
- 后端服务是否正常运行

### Q: AI 功能无法使用？
A: AI 功能需要配置 Dify 相关的环境变量，请检查 `.env` 文件中的配置是否正确。

### Q: 如何同步多设备间的阅读进度？
A: 目前需要通过后端服务同步，确保多个设备连接到同一个后端服务地址。

## 故障排除

### 网络连接问题
1. 检查设备的网络连接
2. 如果使用代理，确保代理配置正确
3. 尝试切换不同的小说站点

### 应用启动失败
1. 检查 Docker 服务是否运行
2. 查看容器日志：`docker-compose logs -f`
3. 确认端口没有被其他程序占用

### 缓存相关问题
1. 清除应用缓存：在设置页面选择"清除缓存"
2. 重启后端服务
3. 检查数据库连接状态

### 性能优化
1. 定期清理不需要的缓存内容
2. 限制同时缓存的章节数量
3. 关闭不需要的 AI 功能

## 联系支持

如果遇到本指南未涵盖的问题，请通过以下方式获取帮助：

- GitHub Issues：https://github.com/yedazhi/novel_builder/issues
- 项目文档：https://github.com/yedazhi/novel_builder/docs
- 邮件支持：yedazhi@c2h4.cn

---

## 更新日志

### v1.0.0
- 初始版本发布
- 基本的搜索、阅读、缓存功能
- Flutter 移动应用和 FastAPI 后端

### v0.2.0
- 添加 AI 增强功能
- 改进缓存系统
- 优化用户界面

更多信息请查看 [CHANGELOG.md](CHANGELOG.md)